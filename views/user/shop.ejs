<%- include('../partials/user/header')%>

<style>
  .page-link.active {
    background-color: #007bff; /* Change this to the desired background color for the active page */
    color: #fff; /* Change this to the desired text color for the active page */
    /* Add any additional styling as needed */
}

</style>
<!-- Product -->
<div class="bg0 m-t-23 p-b-140">
  <div class="container">
    <div class="flex-w flex-sb-m p-b-52">
      <div class="flex-w flex-l-m filter-tope-group m-tb-10">
        <a href="/shop" > <button
          class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5 how-active1"
          data-filter="*"
        >
          All Products
        </button></a>

        <a href="/categorySearch?category=653a3af7e42832e518594666" > <button
          class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5"
          data-filter=".women"
        >
         Shirt
        </button></a>

        <a href="/categorySearch?category=653a3b0fe42832e51859466a" > <button
          class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5"
          data-filter=".women"
        >
         watches
        </button></a>

        <a href="/categorySearch?category=65695e2ccfc611746474b5a7" > <button
          class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5"
          data-filter=".women"
        >
         Pants
        </button></a>

      
      </div>

      <div class="flex-w flex-c-m m-tb-10">
        <div
          class="flex-c-m stext-106 cl6 size-104 bor4 pointer hov-btn3 trans-04 m-r-8 m-tb-4 js-show-filter" id="dropdowns"
        >
          <i
            class="icon-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-filter-list"
          ></i>
          <i
            class="icon-close-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-close dis-none"
          ></i>
          Filter
        </div>


        <!-- sample for search -->

        <div class="col-6 col-md-4 order-2 order-md-1 site-search-icon text-left">
          <form action="/search-product" method="post" style="border: 1px solid #ccc; width:130px;  padding: 5px; border-radius: 5px;" class="site-block-top-search">
            <span class="icon icon-search2"></span>
            <input type="text" style="width: 100%;" class="form-control border-0" name="product" placeholder="Search">
          </form>
        </div>
        

      </div>

      <!-- Search product -->
      <div class="dis-none panel-search w-full p-t-10 p-b-15">
        <div class="bor8 dis-flex p-l-15">
          <button class="size-113 flex-c-m fs-16 cl2 hov-cl1 trans-04">
            <i class="zmdi zmdi-search"></i>
          </button>

          <input
            class="mtext-107 cl2 size-114 plh2 p-r-15"
            type="text"
            name="search-product"
            placeholder="Search"
          />
        </div>
      </div>

      <!-- Filter -->
      <div class="dis-none panel-filter w-full p-t-10">
        <div class="wrap-filter flex-w bg6 w-full p-lr-40 p-t-27 p-lr-15-sm">
         
    
          <div class="container mt-5">
            <form id="filterForm" action="/filtering" method="post" class="row">
        
                <!-- Price Filter -->
                <div class="col-md-4">
                    <h3>Filter by Price</h3>
                    <div class="form-group mt-3">
                        <div class="form-check">
                            <input type="radio" name="price" value="0-500" class="form-check-input">
                            <label class="form-check-label"> $0 - $500 </label>
                        </div>
                        <div class="form-check">
                            <input type="radio" name="price" value="500-1000" class="form-check-input">
                            <label class="form-check-label"> $500 - $1000 </label>
                        </div>
                        <div class="form-check">
                            <input type="radio" name="price" value="1000-1500" class="form-check-input">
                            <label class="form-check-label"> $1000 - $1500 </label>
                        </div>
                    </div>
                </div>
        
                <!-- Category Filter -->
                <div class="col-md-4">
                    <h3>Filter by Category</h3>
                    <div class="form-group mt-3">
                        <% category.forEach((element) => { %>
                            <div class="form-check">
                                <input type="radio" name="category" value="<%= element._id %>" class="form-check-input">
                                <label class="form-check-label">
                                   <%= element.categoryName %>
                                </label>
                            </div>
                        <% }) %>
                    </div>
                </div>
        
               <!-- Brand Filter -->
        <div class="col-md-4">
          <h3>Filter by Brand</h3>
          <div class="form-group">
              <div class="row">
                  <!-- Display items in two columns -->
                  <% brands.forEach((element) => { %>
                      <div class="col-md-6">
                          <div class="form-check">
                              <input type="radio" name="brand" value="<%= element.brand_name %>" class="form-check-input">
                              <label class="form-check-label">
                                  <i class="fas fa-gem"></i> <%= element.brand_name %>
                              </label>
                          </div>
                      </div>
                  <% }) %>
              </div>
          </div>
      </div>
        
                <!-- Apply and Reset Buttons -->
                <div class="col-md-12 text-center mt-3">
                    <button type="" class="btn btn-primary">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetFilters()">
                        <i class="fas fa-undo"></i> Reset Filters
                    </button>
                </div>
        
                <!-- Display Filtered Results (you can replace this with your actual product display) -->
        
            </form>
        </div>
        
      
      
      
      
      <script>
          function resetFilters() {
              // Reset all radio buttons in the form
              var form = document.getElementById('filterForm');
              var radioButtons = form.querySelectorAll('input[type="radio"]');
              
              for (var i = 0; i < radioButtons.length; i++) {
                  radioButtons[i].checked = false;
              }
          }
      </script>
      
      
  
  </body>
  </html>

        </div>
      </div>
    </div>


    <!-- product shows start from here -->

    <div class="row isotope-grid" id="filter">

      <% products.forEach(element =>{ %>
        <div class="-sm-6col col-md-4 col-lg-3 p-b-35 isotope-item women">
          <!-- Block2 -->
          <div class="block2">
            <div class="block2-pic hov-img0 position-relative">
              <!-- Add the offer box here -->
              
              <% if ((element.offer && element.offer > 0) || (element.category.offer && element.category.offer > 0)) { %>
                <div class="offer-box position-absolute top-0 start-0 bg-primary text-white p-2" style="position: absolute; width: 270px;">
                  <% if (element.offer && element.offer > element.category.offer) { %>
                    Special Product Offer: <%= element.offer %>% 
                  <% } else { %>
                    Special Category Offer: <%= element.category.offer %>%
                  <% } %>
                </div>
              <% } %>
              
              
            
              <!-- Product image -->
              <img
                src="data:<%= element.images[0].contentType %>;base64,<%= element.images[0].data.toString('base64')%>"
                alt="IMG-PRODUCT"
                style="width: 270px; height: 334.34px"
              />
    
              
            </div>
    
            <div class="block2-txt flex-w flex-t p-t-14">
              <div class="block2-txt-child1 flex-col-l">
                <a
                  href="/product/Details/<%= element._id%>"
                  class="stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6"
                >
                  <h6><%= element.product_name.substring(0, 25) + '...' %></h6>
                </a>
    
                <button
                  type="submit"
                  class="add-cart btn btn-primary"
                  onclick="addCart('<%= element._id %>')"
                >
                  + Add To Cart
                </button>
    
                <div class="rating">
                  <i class="fa fa-star-o"></i>
                  <i class="fa fa-star-o"></i>
                  <i class="fa fa-star-o"></i>
                  <i class="fa fa-star-o"></i>
                  <i class="fa fa-star-o"></i>
                </div>
    
                <span class="stext-105 cl3"> <%= element.price%> </span>
              </div>
    
              <div class="block2-txt-child2 flex-r p-t-3">
                <a
                  href="#"
                  class="btn-addwish-b2 dis-block pos-relative js-addwish-b2"
                >
                  <img
                    class="icon-heart1 dis-block trans-04"
                    src="images/icons/icon-heart-01.png"
                    alt="ICON"
                  />
                  <img
                    class="icon-heart2 dis-block trans-04 ab-t-l"
                    src="images/icons/icon-heart-02.png"
                    alt="ICON"
                  />
                </a>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
    

     <!-- Pagination controls -->
              
     <div class="pagination" style="margin-top: 15px;">
      <% for (let i = 1; i <= totalPages; i++) { %>
         <!-- <% console.log(i+"  ",currentPage) %> -->
        <% if (i == currentPage) { %>
          <a href="?page=<%= i %>" class="page-link active" id="page<%= i %>"><%= i %></a>
        <% } else { %>
          <a href="?page=<%= i %>" class="page-link" id="page<%= i %>"><%= i %></a>
        <% } %>
      <% } %>
    </div>

<!-- modal -->

<div id="modalshow" class="wrap-modal1 js-modal1 p-t-60 p-b-20">
  <div class="overlay-modal1 js-hide-modal1"></div>

  <div class="container">
    <div class="bg0 p-t-60 p-b-30 p-lr-15-lg how-pos3-parent">
      <button class="how-pos3 hov3 trans-04 js-hide-modal1">
        <img src="/images/icons/icon-close.png" alt="CLOSE" />
      </button>

      <div class="row">
        <div class="col-md-6 col-lg-7 p-b-30">
          <div class="p-l-25 p-r-30 p-lr-0-lg">
            <div class="wrap-slick3 flex-sb flex-w">
              <div class="wrap-slick3-dots"></div>
              <div class="wrap-slick3-arrows flex-sb-m flex-w"></div>

              <div class="slick3 gallery-lb">
                <div
                  class="item-slick3"
                  data-thumb="images/product-detail-01.jpg"
                >
                  <div class="wrap-pic-w pos-relative">
                    <img
                      src="/images/product-detail-01.jpg"
                      alt="IMG-PRODUCT"
                    />

                    <a
                      class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04"
                      href="/images/product-detail-01.jpg"
                    >
                      <i class="fa fa-expand"></i>
                    </a>
                  </div>
                </div>

                <div
                  class="item-slick3"
                  data-thumb="images/product-detail-02.jpg"
                >
                  <div class="wrap-pic-w pos-relative">
                    <img
                      src="/images/product-detail-02.jpg"
                      alt="IMG-PRODUCT"
                    />

                    <a
                      class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04"
                      href="/images/product-detail-02.jpg"
                    >
                      <i class="fa fa-expand"></i>
                    </a>
                  </div>
                </div>

                <div
                  class="item-slick3"
                  data-thumb="images/product-detail-03.jpg"
                >
                  <div class="wrap-pic-w pos-relative">
                    <img
                      src="/images/product-detail-03.jpg"
                      alt="IMG-PRODUCT"
                    />

                    <a
                      class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04"
                      href="/images/product-detail-03.jpg"
                    >
                      <i class="fa fa-expand"></i>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-5 p-b-30">
          <div class="p-r-50 p-t-5 p-lr-0-lg">
            <h4 class="mtext-105 cl2 js-name-detail p-b-14"></h4>

            <span class="mtext-106 cl2"> $58.79 </span>

            <p class="stext-102 cl3 p-t-23">
              Nulla eget sem vitae eros pharetra viverra. Nam vitae luctus
              ligula. Mauris consequat ornare feugiat.
            </p>

            <!--  -->
            <div class="p-t-33">
              <div class="flex-w flex-r-m p-b-10">
                <div class="size-203 flex-c-m respon6">Size</div>

                <div class="size-204 respon6-next">
                  <div class="rs1-select2 bor8 bg0">
                    <select class="js-select2" name="time">
                      <option>Choose an option</option>
                      <option>Size S</option>
                      <option>Size M</option>
                      <option>Size L</option>
                      <option>Size XL</option>
                    </select>
                    <div class="dropDownSelect2"></div>
                  </div>
                </div>
              </div>

              <div class="flex-w flex-r-m p-b-10">
                <div class="size-203 flex-c-m respon6">Color</div>

                <div class="size-204 respon6-next">
                  <div class="rs1-select2 bor8 bg0">
                    <select class="js-select2" name="time">
                      <option>Choose an option</option>
                      <option>Red</option>
                      <option>Blue</option>
                      <option>White</option>
                      <option>Grey</option>
                    </select>
                    <div class="dropDownSelect2"></div>
                  </div>
                </div>
              </div>

              <div class="flex-w flex-r-m p-b-10">
                <div class="size-204 flex-w flex-m respon6-next">
                  <div class="wrap-num-product flex-w m-r-20 m-tb-10">
                    <div
                      class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m"
                    >
                      <i class="fs-16 zmdi zmdi-minus"></i>
                    </div>

                    <input
                      class="mtext-104 cl3 txt-center num-product"
                      type="number"
                      name="num-product"
                      value="1"
                    />

                    <div
                      class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m"
                    >
                      <i class="fs-16 zmdi zmdi-plus"></i>
                    </div>
                  </div>

                  <button
                    class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 js-addcart-detail"
                  >
                    Add to cart
                  </button>
                </div>
              </div>
            </div>

            <!--  -->
            <div class="flex-w flex-m p-l-100 p-t-40 respon7">
              <div class="flex-m bor9 p-r-10 m-r-11">
                <a
                  href="#"
                  class="fs-14 cl3 hov-cl1 trans-04 lh-10 p-lr-5 p-tb-2 js-addwish-detail tooltip100"
                  data-tooltip="Add to Wishlist"
                >
                  <i class="zmdi zmdi-favorite"></i>
                </a>
              </div>

              <a
                href="#"
                class="fs-14 cl3 hov-cl1 trans-04 lh-10 p-lr-5 p-tb-2 m-r-8 tooltip100"
                data-tooltip="Facebook"
              >
                <i class="fa fa-facebook"></i>
              </a>

              <a
                href="#"
                class="fs-14 cl3 hov-cl1 trans-04 lh-10 p-lr-5 p-tb-2 m-r-8 tooltip100"
                data-tooltip="Twitter"
              >
                <i class="fa fa-twitter"></i>
              </a>

              <a
                href="#"
                class="fs-14 cl3 hov-cl1 trans-04 lh-10 p-lr-5 p-tb-2 m-r-8 tooltip100"
                data-tooltip="Google Plus"
              >
                <i class="fa fa-google-plus"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- //modal end here -->
</div>
</div>
</div>


<script>
  const alertBox = document.getElementById("alert-box");
  const flashMessage = document.getElementById("flash-message");

  function addCart(id) {
    fetch(`/cart/${id}/passdata`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then(async(response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        } 

          let v = await response.json()
          console.log(v);
          return v
        
      })
      .then((data) => {
       
        flashMessage.textContent = "Item added to cart!";
        flashMessage.style.display = "inline-block";
        alertBox.style.display = "block";
        

        setTimeout(() => {
          flashMessage.style.display = "none";
          alertBox.style.display = "none";
        }, 2000);
      

        console.log(data);
        document.getElementById('cartItem').setAttribute("data-notify",data)
      })
      
      .catch((error) => {
        console.log(error);
		flashMessage.textContent = "stock limit exceed";
          flashMessage.style.display = "inline-block";
          alertBox.style.display = "block";
          setTimeout(() => {
            flashMessage.style.display = "none";
            alertBox.style.display = "none";
          }, 2000);
      });
  }
</script>
<script>
  function callModal(id) {
    document.getElementById("modalshow").innerHTML = ``;
  }
</script>



<script>
  document.getElementById('filterForm').addEventListener('submit', function (event) {
    event.preventDefault();
    filterAll();
  });

  function filterAll() {
    let formData = {};

    // Get selected values from radio buttons
    formData.price = document.querySelector('input[type=radio][name=price]:checked')?.value || null;
    formData.category = document.querySelector('input[type=radio][name=category]:checked')?.value || null;
    formData.brand = document.querySelector('input[type=radio][name=brand]:checked')?.value || null;

    // Log the selected filter options
    console.log('Selected Filter Options:', formData);

    // Make the fetch request
    fetch('/filtering', {
      method: 'POST',
      body: new URLSearchParams(formData),
    })
      .then(response => {
        if (!response.ok) {
          throw new Error(response.status === 400 ? 'Insufficient stock.' : 'Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        console.log('Filtered Data:', data);

        // Update the UI with the filtered data
        document.getElementById("dropdowns").click();

        // Access as DOM above define an id as filter
        // Creates all tags inside that div
        const filter = document.getElementById("filter");
        filter.innerHTML = "";

        if (data.products.length) {
          data.products.forEach(product => {
            const decodedImageData = atob(product.images[0].data);
            const uint8Array = new Uint8Array(decodedImageData.length);

            for (let i = 0; i < decodedImageData.length; ++i) {
              uint8Array[i] = decodedImageData.charCodeAt(i);
            }

            const blob = new Blob([uint8Array], { type: product.images[0].contentType });
            const imageSrc = URL.createObjectURL(blob);

            const div = document.createElement("div");
            div.classList.add("-sm-6col", "col-md-4", "col-lg-3", "p-b-35", "isotope-item", "women");
            div.innerHTML = `
              <!-- Block2 -->
              <div class="block2">
                <div class="block2-pic hov-img0 position-relative">
                  <!-- Add the offer box here -->
                  <div class="offer-box position-absolute top-0 start-0 bg-primary text-white p-2">
                    <span>Special Offer : ${product.offer}</span>
                  </div>
                  <!-- Product image -->
                  <img src="${imageSrc}" alt="IMG-PRODUCT" style="width: 270px; height: 334.34px"/>
                </div>
                <!-- Rest of your HTML content for each product -->
                <div class="block2-txt flex-w flex-t p-t-14">
                  <div class="block2-txt-child1 flex-col-l">
                    <a href="/product/Details/${product._id}" class="stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6">
                      <h6>${product.product_name.substring(0, 25) + '...'}</h6>
                    </a>

                    <button type="submit" class="add-cart btn btn-primary" onclick="addCart('${product._id}')">
                      + Add To Cart
                    </button>

                    <div class="rating">
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                      <i class="fa fa-star-o"></i>
                    </div>

                    <span class="stext-105 cl3">${product.price}</span>
                  </div>

                  <div class="block2-txt-child2 flex-r p-t-3">
                    <a href="#" class="btn-addwish-b2 dis-block pos-relative js-addwish-b2">
                      <img class="icon-heart1 dis-block trans-04" src="images/icons/icon-heart-01.png" alt="ICON"/>
                      <img class="icon-heart2 dis-block trans-04 ab-t-l" src="images/icons/icon-heart-02.png" alt="ICON"/>
                    </a>
                  </div>
                </div>
              </div>
            </div>
            `;
            filter.appendChild(div);
          });
        } else {
          filter.innerHTML = "<h3 >Not found </h3>";
        }
      })
      .catch(error => {
        console.error(error);
      });
  }
</script>


<%- include('../partials/user/footer')%>
